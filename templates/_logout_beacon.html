<script>
    (function () {
        var role = "{{ role|e }}";
        var navigating = false;

        function sendLogout() {
            try { navigator.sendBeacon("/logout/" + role); } catch (e) {}
        }

        // If the user clicks a link/button or submits a form, that's an intentional navigation.
        // We do NOT want to log out in those cases (e.g., delete -> redirect back to /data).
        document.addEventListener("submit", function () {
            navigating = true;
        }, true);

        document.addEventListener("click", function (e) {
            // Any click that likely causes navigation or a form post
            if (e.target && e.target.closest("a, button, input[type=submit]")) {
                navigating = true;
            }
        }, true);

        // Fires on unloads including tab close AND normal navigations.
        // Only logout when it's NOT a user-initiated navigation.
        window.addEventListener("pagehide", function () {
            if (!navigating) sendLogout();
        });
    })();
</script>
